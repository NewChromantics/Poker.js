<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<style>
			:root
			{
				--paper: #eee;
				--border: #aaa;
				--suit-unknown: #aaa;
				--suit-heart: #d42a2a;
				--suit-diamond: #d4962a;
				--suit-spade: #333;
				--suit-club: #2a60d4;
				
				/* 3.5 inches x 2.5 inches */
				--cardWidth: 30pt;
				--cardHeight: calc( var(--cardWidth) * 1.4 );
				
				--raisePx: 10px;
			}
			
			html
			{
				background: #13a8a8;
				color:	var(--paper);
				font-family: sans-serif;
				font-weight: bold;
				font-size: 10pt;
			}
			
			.Card
			{
				--shadowHeight: 2px;
				--shadowWidth: 1px;
				--shadowRadius: 0.5px;
				
				xbox-sizing:	border-box;	/* border is part of size */
				transition: all ease 0.1s;
				
				display: inline-block;
				width: var(--cardWidth);
				height: var(--cardHeight);
				background: var(--paper);
				border-radius: 10%;
				border: 1px solid var(--border);
				margin:	3pt;
				padding: 0pt;
				font-family: "serif";
				font-weight: bold;
				font-size: calc( var(--width) * 0.3 );
				text-align: center;
				color: var(--suit-unknown);
				filter: drop-shadow( var(--shadowWidth) var(--shadowHeight) var(--shadowRadius) rgba(0,0,0,0.5) );
			}
			
			.Card[onclick]
			{
				background:red!;
				cursor: pointer;
			}
			/* only add hover on devices with hover capabilities */
			@media(hover) 
			{
				.Card[onclick]:hover
				{
					transform: translate( -1px, calc( var(--raisePx) * -1 ) ) rotate(-2deg);
					xxborder-bottom: calc( var(--raisePx) * 1 ) solid rgba(0,0,0,0);
					--shadowHeight: var(--raisePx);
					--shadowWidth: 3px;
					--shadowRadius: 3px;
				}
			}	
			
			.Card:before 
			{
				display: block;
				content: attr(Value);
			}
			.Card[Value="11"]:before	{	content: "J";	}
			.Card[Value="12"]:before	{	content: "Q";	}
			.Card[Value="13"]:before	{	content: "K";	}
			.Card[Value="14"]:before	{	content: "A";	}
			
			.Card:after
			{
				display: block;
				content: attr(Suit);
				font-size: calc( var(--width) * 0.6 );
			}
			.Card[Suit=Heart]	{	color: var(--suit-heart);	}
			.Card[Suit=Diamond]	{	color: var(--suit-diamond);	}
			.Card[Suit=Spade]	{	color: var(--suit-spade);	}
			.Card[Suit=Club]	{	color: var(--suit-club);	}
			
			.Card[Suit=Heart]:after
			{
				content: "\2665";	/* &#9829 */
			}
			.Card[Suit=Diamond]:after
			{
				content: "\2666";	/* &#9830 */
			}
			.Card[Suit=Spade]:after
			{
				content: "\2660";	/* &#9824 */
			}
			.Card[Suit=Club]:after
			{
				content: "\2663";	/* &#9827 */
			}
			
			#BoardContainer
			{
				padding: 10pt;
				background:	rgba(0,0,0,0.3);
				border-radius: 10pt;
				margin: 10pt;
			}
			
			#Board
			{
				min-height: calc( var(--cardHeight) * 1.2 );
			}
			
		</style>
	</head>
	<body>
		
		<div id=BoardContainer>
			<label>Board</label>
			<div id=Board></div>
			<div id=BestHandCards></div>
			<div id=BestHandName></div>
		</div>
		
		<div id=Pile></div>
		
		<script type=module>
			import * as Poker from './Poker.js'
			
			function GetCardMeta(CardDiv)
			{
				const Suit = CardDiv.getAttribute('Suit');
				const Value = CardDiv.getAttribute('Value');
				return new Poker.Card(Suit,Value);
			}
			
			function GetBoardCardMetas()
			{
				const CardDivs = Array.from( document.querySelectorAll(`#Board .Card`) );
				const CardMetas = CardDivs.map( GetCardMeta );
				return CardMetas;
			}
			
			function GetBoardBestHand()
			{
				const Cards = GetBoardCardMetas();
				//	get new score
				try
				{
					const Hand = Poker.GetScoringHand(Cards);
					return Hand;
				}
				catch(e)
				{
					return `Error: ${e}`;
				}
			}
			
			function OnBoardChanged()
			{
				const BestHand = GetBoardBestHand();
				const BestHandCardsDiv = document.querySelector(`#BestHandCards`);
				const BestHandNameDiv = document.querySelector(`#BestHandName`);
				const NewCardDivs = BestHand.Cards.map( MakeCardDiv );
				BestHandCardsDiv.replaceChildren(...NewCardDivs);
				BestHandNameDiv.innerText = BestHand.Type;
			}
			
			function OnCardClicked(CardDiv)
			{
				if ( CardDiv.parentElement == Pile )
				{
					AddToBoard(CardDiv);
				}
				else if ( CardDiv.parentElement == Board )
				{
					AddToPile(CardDiv);
				}
			}
			
			
			function MakeCardDiv(CardMeta,Clickable)
			{
				const CardDiv = document.createElement(`div`);
				CardDiv.classList.add(`Card`);
				CardDiv.setAttribute('Value',CardMeta.Value);
				CardDiv.setAttribute('Suit',CardMeta.Suit);
				
				if ( Clickable === true )
				{
					CardDiv.setAttribute('onclick','');
					CardDiv.onclick = () => { OnCardClicked(CardDiv); };
				}
				return CardDiv;
			}
			
			function AddToPile(CardDiv)
			{
				Pile.appendChild(CardDiv);
				OnBoardChanged();
			}
			
			function AddToBoard(CardDiv)
			{
				Board.appendChild(CardDiv);
				OnBoardChanged();
			}
			
			function LoadDeck()
			{
				function MakeCard(CardMeta)
				{
					const Card = MakeCardDiv(CardMeta,true);
					AddToPile(Card);
				}
				const Cards = Poker.GetAllCards();
				Cards.forEach( MakeCard );
			}
			
			LoadDeck();
			
		</script>
		
		
	</body>
</html>

